--STEP 1 -  Create IT Session Database
CREATE OR REPLACE DATABASE IMT577_DW_KETKI_GODSE_STAGE

--STEP 2 - CREATE IT SESSION DW
CREATE OR REPLACE WAREHOUSE "IMT577_DW_KETKI_GODSE_STAGE" WITH WAREHOUSE_SIZE='XSMALL' AUTO_SUSPEND=600 AUTO_RESUME=TRUE COMMENT='';

--STEP 3- CREATE STAGE
CREATE OR REPLACE STAGE "IMT577_DW_KETKI_GODSE_STAGE"."PUBLIC"."STAGE_ITSESSION"

--STEP 4- CREATE FILE FORMAT
CREATE OR REPLACE FILE FORMAT CSV_SKIP_HEADER
type= 'CSV'
field_delimiter=','
FIELD_OPTIONALLY_ENCLOSED_BY='"'
skip_header=1;

--STEP 5- CREATE TABLES
CREATE OR REPLACE TABLE STAGE_CHANNEL (
	CHANNELID NUMBER(38,0),
	CHANNELCATEGORYID NUMBER(38,0),
	CHANNEL VARCHAR(16777216),
	CREATEDDATE TIMESTAMP_NTZ(9),
	CREATEDBY VARCHAR(16777216),
	MODIFIEDDATE VARCHAR(16777216),
	MODIFIEDBY VARCHAR(16777216)
);

CREATE OR REPLACE TABLE STAGE_CHANNELCATEGORY (
    CHANNELCATEGORYID NUMBER(38,0),
	CHANNELCATEGORY VARCHAR(16777216),
	CREATEDDATE TIMESTAMP_NTZ(9),
	CREATEDBY VARCHAR(16777216),
	MODIFIEDDATE VARCHAR(16777216),
	MODIFIEDBY VARCHAR(16777216)
);

CREATE OR REPLACE TABLE STAGE_CUSTOMER (
	CUSTOMERID VARCHAR(16777216),
	SUBSEGMENTID NUMBER(38,0),
	FIRSTNAME VARCHAR(16777216),
	LASTNAME VARCHAR(16777216),
	GENDER VARCHAR(16777216),
	EMAILADDRESS VARCHAR(16777216),
	ADDRESS VARCHAR(16777216),
	CITY VARCHAR(16777216),
	STATEPROVINCE VARCHAR(16777216),
	COUNTRY VARCHAR(16777216),
	POSTALCODE NUMBER(38,0),
	PHONENUMBER VARCHAR(16777216),
	CREATEDDATE TIMESTAMP_NTZ(9),
	CREATEDBY VARCHAR(16777216),
	MODIFIEDDATE VARCHAR(16777216),
	MODIFIEDBY VARCHAR(16777216)
);

CREATE OR REPLACE TABLE STAGE_PRODUCT (
	PRODUCTID NUMBER(38,0),
	PRODUCTTYPEID NUMBER(38,0),
	PRODUCT VARCHAR(16777216),
	COLOR VARCHAR(16777216),
	STYLE VARCHAR(16777216),
	UNITOFMEASUREID NUMBER(38,0),
	WEIGHT NUMBER(38,2),
	PRICE NUMBER(38,2),
	COST NUMBER(38,2),
	CREATEDDATE TIMESTAMP_NTZ(9),
	CREATEDBY VARCHAR(16777216),
	MODIFIEDDATE VARCHAR(16777216),
	MODIFIEDBY VARCHAR(16777216),
	WHOLESALEPRICE NUMBER(38,2)
);

CREATE OR REPLACE TABLE STAGE_PRODUCTCATEGORY (
	PRODUCTCATEGORYID NUMBER(38,0),
	PRODUCTCATEGORY VARCHAR(16777216),
	CREATEDDATE TIMESTAMP_NTZ(9),
	CREATEDBY VARCHAR(16777216),
	MODIFIEDDATE VARCHAR(16777216),
	MODIFIEDBY VARCHAR(16777216)
);

CREATE OR REPLACE TABLE STAGE_PRODUCTTYPE (
	PRODUCTTYPEID NUMBER(38,0),
	PRODUCTCATEGORYID NUMBER(38,0),
	PRODUCTTYPE VARCHAR(16777216),
	CREATEDDATE TIMESTAMP_NTZ(9),
	CREATEDBY VARCHAR(16777216),
	MODIFIEDDATE VARCHAR(16777216),
	MODIFIEDBY VARCHAR(16777216)
);

CREATE OR REPLACE TABLE STAGE_RESELLER (
	RESELLERID VARCHAR(16777216),
	CONTACT VARCHAR(16777216),
	EMAILADDRESS VARCHAR(16777216),
	ADDRESS VARCHAR(16777216),
	CITY VARCHAR(16777216),
	STATEPROVINCE VARCHAR(16777216),
	COUNTRY VARCHAR(16777216),
	POSTALCODE NUMBER(38,0),
	PHONENUMBER VARCHAR(16777216),
	CREATEDDATE TIMESTAMP_NTZ(9),
	CREATEDBY VARCHAR(16777216),
	MODIFIEDDATE VARCHAR(16777216),
	MODIFIEDBY VARCHAR(16777216),
	RESELLERNAME VARCHAR(16777216)
);

CREATE OR REPLACE TABLE STAGE_SALESDETAIL (
	SALESDETAILID NUMBER(38,0),
	SALESHEADERID NUMBER(38,0),
	PRODUCTID NUMBER(38,0),
	SALESQUANTITY NUMBER(38,0),
	SALESAMOUNT NUMBER(38,2),
	CREATEDDATE TIMESTAMP_NTZ(9),
	CREATEDBY VARCHAR(16777216),
	MODIFIEDDATE VARCHAR(16777216),
	MODIFIEDBY VARCHAR(16777216)
);

CREATE OR REPLACE TABLE STAGE_SALESHEADER_NEW (
	SALESHEADERID NUMBER(38,0),
	DATE DATE,
	CHANNELID NUMBER(38,0),
	STOREID VARCHAR(16777216),
	CUSTOMERID VARCHAR(16777216),
	RESELLERID VARCHAR(16777216),
	CREATEDDATE DATE,
	CREATEDBY VARCHAR(16777216),
	MODIFIEDDATE VARCHAR(16777216),
	MODIFIEDBY VARCHAR(16777216)
);

CREATE OR REPLACE TABLE STAGE_SEGMENT (
	SEGMENTID NUMBER(38,0),
	SEGMENT VARCHAR(16777216),
	CREATEDDATE TIMESTAMP_NTZ(9),
	CREATEDBY VARCHAR(16777216),
	MODIFIEDDATE TIMESTAMP_NTZ(9),
	MODIFIEDBY VARCHAR(16777216)
);

CREATE OR REPLACE TABLE STAGE_STORE (
	STOREID NUMBER(38,0),
	SUBSEGMENTID NUMBER(38,0),
	STORENUMBER NUMBER(38,0),
	STOREMANAGER VARCHAR(16777216),
	ADDRESS VARCHAR(16777216),
	CITY VARCHAR(16777216),
	STATEPROVINCE VARCHAR(16777216),
	COUNTRY VARCHAR(16777216),
	POSTALCODE NUMBER(38,0),
	PHONENUMBER VARCHAR(16777216),
	CREATEDDATE TIMESTAMP_NTZ(9),
	CREATEDBY VARCHAR(16777216),
	MODIFIEDDATE VARCHAR(16777216),
	MODIFIEDBY VARCHAR(16777216)
);

CREATE OR REPLACE TABLE STAGE_TARGETDATA_CHANNELRESELLERANDSTORE (
	YEAR NUMBER(38,0),
	CHANNELNAME VARCHAR(16777216),
	TARGETNAME VARCHAR(16777216),
	TARGETSALESAMOUNT NUMBER(38,0)
);

CREATE OR REPLACE TABLE STAGE_TARGETDATA_PRODUCT (
	PRODUCTID NUMBER(38,0),
	PRODUCT VARCHAR(16777216),
	YEAR NUMBER(38,0),
	SALESQUANTITYTARGET NUMBER(38,0)
);

UPDATE STAGE_SALESHEADER_NEW
SET DATE = REPLACE(DATE, '0014', '2014')
WHERE DATE LIKE '0014%';

UPDATE STAGE_SALESHEADER_NEW
SET DATE = REPLACE(DATE, '0013', '2013')
WHERE DATE LIKE '0013%';

